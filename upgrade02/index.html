<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¿·è·¯è„±å‡ºã‚²ãƒ¼ãƒ çš„ãª</title>
<style>
/* CSSå¤‰æ•°ã§ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆä½ç½®ã‚’ç®¡ç† */
:root{
  --x: 10%;
  --y: 10%;
  --size: 100px;
  --soft: 50px;
  --dim: 0.98;
}

*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  font-family: 'Arial', sans-serif;
  overflow: hidden;
}

/* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ */
.game-container{
  min-height:100vh;
  position:relative;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  overflow:hidden;
  outline: none;
}

/* ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆåŠ¹æœ */
.game-container::before{
  content:"";
  position:absolute;
  inset:0;
  z-index:10;
  background:
    radial-gradient(
      circle at var(--x) var(--y),
      rgba(0,0,0,0) calc(var(--size) * 0.3),
      rgba(0,0,0,0.5) calc(var(--size) * 0.7),
      rgba(0,0,0,var(--dim)) calc(var(--size) + var(--soft))
    );
  pointer-events:none;
  transition: background 60ms ease-out;
}

/* è¿·è·¯ã‚¨ãƒªã‚¢ */
.maze{
  position: relative;
  width: 100%;
  height: 100vh;
  z-index: 1;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆé’ã„å…‰ã‚‹å††ï¼‰ */
.player{
  position: absolute;
  width: 30px;
  height: 30px;
  background: radial-gradient(circle, #4dabf7 0%, #1971c2 100%);
  border-radius: 50%;
  border: 3px solid #74c0fc;
  box-shadow: 0 0 30px rgba(77,171,247,0.8);
  z-index: 5;
  transition: all 0.15s ease-out;
  left: 5%;
  top: 5%;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‘ãƒ«ã‚¹åŠ¹æœ */
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 30px rgba(77,171,247,0.8); }
  50% { box-shadow: 0 0 50px rgba(77,171,247,1); }
}

.player{
  animation: pulse 2s infinite;
}

/* ã‚´ãƒ¼ãƒ«ï¼ˆç·‘ã®å…‰ã‚‹å††ï¼‰ */
.goal{
  position: absolute;
  width: 50px;
  height: 50px;
  background: radial-gradient(circle, #51cf66 0%, #2f9e44 100%);
  border-radius: 50%;
  border: 4px solid #8ce99a;
  box-shadow: 0 0 40px rgba(81,207,102,0.9);
  z-index: 5;
  right: 5%;
  bottom: 5%;
}

/* éšœå®³ç‰©ï¼ˆå£ï¼‰ */
.wall{
  position: absolute;
  background: linear-gradient(135deg, #f03e3e 0%, #c92a2a 100%);
  border: 2px solid #ff6b6b;
  box-shadow: 0 0 20px rgba(240,62,62,0.5);
  z-index: 3;
}

/* åé›†ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆæ˜Ÿï¼‰ */
.star{
  position: absolute;
  width: 25px;
  height: 25px;
  background: radial-gradient(circle, #ffd43b 0%, #fab005 100%);
  border-radius: 50%;
  border: 2px solid #ffe066;
  box-shadow: 0 0 20px rgba(255,212,59,0.8);
  z-index: 4;
  cursor: pointer;
  transition: transform 0.2s;
}

.star:hover{
  transform: scale(1.3) rotate(180deg);
}

/* æ˜Ÿã®è¼ãåŠ¹æœ */
@keyframes twinkle {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.star{
  animation: twinkle 1.5s infinite;
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
.status{
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 20;
  background: rgba(0,0,0,0.8);
  padding: 15px 30px;
  border-radius: 15px;
  color: #ffd43b;
  font-size: 20px;
  font-weight: bold;
  border: 2px solid #fab005;
  text-align: center;
}

/* ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼/ã‚¯ãƒªã‚¢ç”»é¢ */
.modal{
  position: fixed;
  inset: 0;
  z-index: 100;
  background: rgba(0,0,0,0.9);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.modal.show{
  display: flex;
}

.modal-content{
  text-align: center;
  color: white;
}

.modal-title{
  font-size: 48px;
  margin-bottom: 20px;
  color: #51cf66;
}

.modal-text{
  font-size: 24px;
  margin-bottom: 30px;
}

.btn{
  padding: 15px 40px;
  font-size: 18px;
  background: linear-gradient(135deg, #4dabf7 0%, #1971c2 100%);
  border: none;
  border-radius: 10px;
  color: white;
  cursor: pointer;
  transition: transform 0.2s;
  box-shadow: 0 5px 20px rgba(77,171,247,0.5);
}

.btn:hover{
  transform: scale(1.1);
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width:768px){
  :root{ --size:130px; --soft:70px; }
  .player{ width: 25px; height: 25px; }
  .goal{ width: 40px; height: 40px; }
  .star{ width: 20px; height: 20px; }
}
</style>
</head>
<body>

<div class="game-container" id="gameContainer" tabindex="0">
  <div class="maze" id="maze">
    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
    <div class="player" id="player"></div>
    
    <!-- ã‚´ãƒ¼ãƒ« -->
    <div class="goal" id="goal"></div>
    
    <!-- éšœå®³ç‰©ï¼ˆå£ï¼‰ -->
    <div class="wall" style="left:20%;top:15%;width:3px;height:200px;"></div>
    <div class="wall" style="left:35%;top:25%;width:250px;height:3px;"></div>
    <div class="wall" style="left:40%;top:40%;width:3px;height:180px;"></div>
    <div class="wall" style="left:55%;top:50%;width:200px;height:3px;"></div>
    <div class="wall" style="left:25%;top:60%;width:150px;height:3px;"></div>
    <div class="wall" style="left:60%;top:20%;width:3px;height:150px;"></div>
    <div class="wall" style="left:70%;top:65%;width:3px;height:200px;"></div>
    <div class="wall" style="left:15%;top:80%;width:300px;height:3px;"></div>
    
    <!-- åé›†ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆæ˜Ÿï¼‰ -->
    <div class="star" style="left:30%;top:35%;" data-collected="false"></div>
    <div class="star" style="left:50%;top:15%;" data-collected="false"></div>
    <div class="star" style="left:65%;top:45%;" data-collected="false"></div>
    <div class="star" style="left:45%;top:70%;" data-collected="false"></div>
    <div class="star" style="left:80%;top:30%;" data-collected="false"></div>
  </div>
  
  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
  <div class="status" id="status">â­ 0 / 5</div>
  
  <!-- ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ç”»é¢ -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">ğŸ‰ ã‚¯ãƒªã‚¢ï¼</div>
      <div class="modal-text" id="modalText">å…¨ã¦ã®æ˜Ÿã‚’é›†ã‚ã¦ã‚´ãƒ¼ãƒ«ã—ã¾ã—ãŸï¼</div>
      <button class="btn" onclick="restartGame()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
    </div>
  </div>
</div>

<script>
/* ========================
   ã‚²ãƒ¼ãƒ åˆæœŸè¨­å®š
   ======================== */
const gameContainer = document.getElementById('gameContainer');
const player = document.getElementById('player');
const goal = document.getElementById('goal');
const maze = document.getElementById('maze');
const stars = document.querySelectorAll('.star');
const walls = document.querySelectorAll('.wall');
const status = document.getElementById('status');
const modal = document.getElementById('modal');

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½ç½®ï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆï¼‰
let playerX = 5;
let playerY = 5;
let collectedStars = 0;
const totalStars = stars.length;

/* ========================
   ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆæ›´æ–°
   ======================== */
function updateSpotlight(){
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿéš›ã®ãƒ”ã‚¯ã‚»ãƒ«ä½ç½®ã‚’å–å¾—
  const rect = player.getBoundingClientRect();
  const containerRect = gameContainer.getBoundingClientRect();
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸­å¿ƒã‚’è¨ˆç®—
  const centerX = rect.left + rect.width/2 - containerRect.left;
  const centerY = rect.top + rect.height/2 - containerRect.top;
  
  // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã«å¤‰æ›
  const x = (centerX / containerRect.width) * 100;
  const y = (centerY / containerRect.height) * 100;
  
  gameContainer.style.setProperty('--x', x + '%');
  gameContainer.style.setProperty('--y', y + '%');
}

/* ========================
   ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•
   ======================== */
function movePlayer(dx, dy){
  // æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—
  const newX = Math.min(95, Math.max(0, playerX + dx));
  const newY = Math.min(95, Math.max(0, playerY + dy));
  
  // ä¸€æ™‚çš„ã«æ–°ã—ã„ä½ç½®ã«ç§»å‹•
  player.style.left = newX + '%';
  player.style.top = newY + '%';
  
  // å£ã¨ã®è¡çªãƒã‚§ãƒƒã‚¯
  if(checkWallCollision()){
    // è¡çªã—ãŸã‚‰å…ƒã®ä½ç½®ã«æˆ»ã™
    player.style.left = playerX + '%';
    player.style.top = playerY + '%';
    return;
  }
  
  // è¡çªãªã—ãªã‚‰ä½ç½®ã‚’æ›´æ–°
  playerX = newX;
  playerY = newY;
  
  // ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆæ›´æ–°
  updateSpotlight();
  
  // æ˜Ÿã¨ã®è¡çªãƒã‚§ãƒƒã‚¯
  checkStarCollision();
  
  // ã‚´ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
  checkGoalCollision();
}

/* ========================
   è¡çªåˆ¤å®š
   ======================== */
function checkWallCollision(){
  const playerRect = player.getBoundingClientRect();
  
  for(let wall of walls){
    const wallRect = wall.getBoundingClientRect();
    if(isColliding(playerRect, wallRect)){
      return true;
    }
  }
  return false;
}

function checkStarCollision(){
  const playerRect = player.getBoundingClientRect();
  
  stars.forEach(star => {
    if(star.getAttribute('data-collected') === 'false'){
      const starRect = star.getBoundingClientRect();
      if(isColliding(playerRect, starRect)){
        // æ˜Ÿã‚’åé›†
        star.setAttribute('data-collected', 'true');
        star.style.opacity = '0';
        star.style.transform = 'scale(2)';
        collectedStars++;
        status.textContent = `â­ ${collectedStars} / ${totalStars}`;
      }
    }
  });
}

function checkGoalCollision(){
  const playerRect = player.getBoundingClientRect();
  const goalRect = goal.getBoundingClientRect();
  
  if(isColliding(playerRect, goalRect)){
    // å…¨ã¦ã®æ˜Ÿã‚’é›†ã‚ã¦ã„ã‚‹å ´åˆã®ã¿ã‚¯ãƒªã‚¢
    if(collectedStars === totalStars){
      setTimeout(() => {
        modal.classList.add('show');
      }, 300);
    }
  }
}

// çŸ©å½¢ã®è¡çªåˆ¤å®š
function isColliding(rect1, rect2){
  return !(rect1.right < rect2.left || 
           rect1.left > rect2.right || 
           rect1.bottom < rect2.top || 
           rect1.top > rect2.bottom);
}

/* ========================
   ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
   ======================== */
const moveSpeed = 2; // ç§»å‹•é€Ÿåº¦ï¼ˆ%ï¼‰

window.addEventListener('keydown', (e) => {
  switch(e.key){
    case 'ArrowLeft': case 'a': case 'A':
      e.preventDefault();
      movePlayer(-moveSpeed, 0);
      break;
    case 'ArrowRight': case 'd': case 'D':
      e.preventDefault();
      movePlayer(moveSpeed, 0);
      break;
    case 'ArrowUp': case 'w': case 'W':
      e.preventDefault();
      movePlayer(0, -moveSpeed);
      break;
    case 'ArrowDown': case 's': case 'S':
      e.preventDefault();
      movePlayer(0, moveSpeed);
      break;
  }
});

/* ========================
   ãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒæ“ä½œ
   ======================== */
let isDragging = false;

gameContainer.addEventListener('pointerdown', () => {
  isDragging = true;
});

gameContainer.addEventListener('pointerup', () => {
  isDragging = false;
});

gameContainer.addEventListener('pointermove', (e) => {
  if(!isDragging) return;
  
  const rect = gameContainer.getBoundingClientRect();
  const targetX = ((e.clientX - rect.left) / rect.width) * 100;
  const targetY = ((e.clientY - rect.top) / rect.height) * 100;
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒã‚¦ã‚¹æ–¹å‘ã«ç§»å‹•
  const dx = targetX - playerX;
  const dy = targetY - playerY;
  const distance = Math.sqrt(dx*dx + dy*dy);
  
  if(distance > 1){
    movePlayer(
      (dx / distance) * moveSpeed,
      (dy / distance) * moveSpeed
    );
  }
});

/* ========================
   ã‚²ãƒ¼ãƒ ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
   ======================== */
function restartGame(){
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®ãƒªã‚»ãƒƒãƒˆ
  playerX = 5;
  playerY = 5;
  player.style.left = playerX + '%';
  player.style.top = playerY + '%';
  
  // æ˜Ÿãƒªã‚»ãƒƒãƒˆ
  collectedStars = 0;
  stars.forEach(star => {
    star.setAttribute('data-collected', 'false');
    star.style.opacity = '1';
    star.style.transform = 'scale(1)';
  });
  
  // UIæ›´æ–°
  status.textContent = `â­ 0 / ${totalStars}`;
  modal.classList.remove('show');
  
  // ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆæ›´æ–°
  updateSpotlight();
}

/* ========================
   åˆæœŸåŒ–
   ======================== */
updateSpotlight();
gameContainer.focus();
</script>

</body>
</html>